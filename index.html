<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Nitro Type Top 1000 Racers</title>
  <style>
    /* ===================================================
       Root Color & Typography Variables
       =================================================== */
    :root {
      --bg-color:        #2a2a2a;  /* dark background */
      --panel-bg:        #333333;  /* panel background */
      --header-bg:       #3a3a3a;  /* header / tab background */
      --accent:          #b71c1c;  /* dark red accent */
      --accent-light:    #d32f2f;  /* lighter red on hover */
      --text-light:      #e0e0e0;  /* light text */
      --text-dim:        #bbbbbb;  /* secondary text */
      --font-family:     'Segoe UI', Tahoma, Verdana, sans-serif;
      --font-size-base:  1rem;     /* 16px */
      --font-size-lg:    2rem;     /* 32px */
      --font-size-md:    1.25rem;  /* 20px */
      --font-size-sm:    0.875rem; /* 14px */
      --transition:      0.3s ease;
    }


    /* ===================================================
       Global Reset & Base Styles
       =================================================== */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      background: var(--bg-color);
      color: var(--text-light);
      font-family: var(--font-family);
      font-size: var(--font-size-base);
      line-height: 1.5;
      overflow-x: hidden;
    }

    a {
      color: var(--accent);
      text-decoration: none;
      transition: color var(--transition);
    }
    a:hover {
      color: var(--accent-light);
    }


    /* ===================================================
       Header / Branding Styles
       =================================================== */
    header {
      text-align: center;
      padding: 20px 0;
      margin-bottom: 20px;
      background: var(--header-bg);
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }

    header h1 {
      font-size: var(--font-size-lg);
      margin-bottom: 8px;
      color: var(--accent);
    }

    header p {
      font-size: var(--font-size-md);
      color: var(--text-dim);
    }

    header p a {
      font-weight: bold;
    }


    /* ===================================================
       Tab Navigation Styles
       =================================================== */
    .tabs {
      display: flex;
      justify-content: center;
      background: var(--header-bg);
      margin-bottom: 20px;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    .tabs .tab {
      flex: 1;
      padding: 12px 20px;
      text-align: center;
      cursor: pointer;
      font-size: var(--font-size-md);
      color: var(--text-light);
      transition: background var(--transition);
    }

    .tabs .tab:hover {
      background: var(--panel-bg);
    }

    .tabs .tab.active {
      background: var(--accent);
      color: #ffffff;
    }


    /* ===================================================
       Table Container and Table Styles
       =================================================== */
    .table-container {
      display: none;
      background: var(--panel-bg);
      border-radius: 4px;
      padding: 10px;
      margin-bottom: 40px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    .table-container.active {
      display: block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: auto;
      font-size: var(--font-size-sm);
    }

    thead th {
      position: sticky;
      top: 0;
      background: var(--accent-light);
      color: #fff;
      font-weight: normal;
      padding: 12px;
      border-bottom: 2px solid var(--bg-color);
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    th, td {
      padding: 10px 8px;
      text-align: center;
      border-bottom: 1px solid #444;
    }

    tbody tr:nth-child(odd) {
      background: #3a3a3a;
    }
    tbody tr:nth-child(even) {
      background: #343434;
    }

    td a.profile-link {
      color: var(--accent);
      word-break: break-all;
      font-size: var(--font-size-sm);
    }
    td a.profile-link:hover {
      color: var(--accent-light);
    }


    /* ===================================================
       Responsive Styles for Narrow Viewports
       =================================================== */
    @media (max-width: 900px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead { display: none; }
      tr {
        margin-bottom: 15px;
      }
      td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
      }
      td::before {
        content: attr(data-label);
        flex: 1 1 40%;
        color: var(--text-dim);
        font-weight: bold;
        text-transform: uppercase;
      }
      td span {
        flex: 1 1 60%;
        text-align: right;
      }
    }


    /* ===================================================
       Utility & Helper Classes
       =================================================== */
    .hidden {
      display: none !important;
    }

    .center {
      text-align: center;
    }

    /* end of CSS */
  </style>
</head>
<body>

  <!-- ================================
       Header / Branding
       ================================ -->
  <header>
    <h1>Nitro Type Top 1000 Racers</h1>
    <p>
      made by
      <a href="https://www.youtube.com/@InternetTyper" target="_blank">
        @InternetTyper on YouTube
      </a>
    </p>
  </header>


  <!-- ================================
       Tab Navigation
       ================================ -->
  <div class="tabs">
    <div class="tab active" data-target="leaderboardSection">Leaderboard</div>
    <div class="tab" data-target="racesPerDaySection">Races Per Day</div>
  </div>


  <!-- ================================
       Leaderboard Section
       ================================ -->
  <section id="leaderboardSection" class="table-container active">
    <table id="leaderboardTable">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Username</th>
          <th>Team Tag</th>
          <th>Title</th>
          <th>Total Races</th>
          <th>Avg WPM</th>
          <th>Top WPM</th>
          <th>Profile Views</th>
          <th>Member Since</th>
          <th>Garage Cars</th>
          <th>Profile URL</th>
          <th>Membership</th>
          <th>Nitros Used</th>
          <th>Longest Session</th>
          <th>League Tier</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows are injected by JavaScript -->
      </tbody>
    </table>
  </section>


  <!-- ================================
       Races Per Day Section
       ================================ -->
  <section id="racesPerDaySection" class="table-container">
    <table id="racesPerDayTable">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Username</th>
          <th>Total Races</th>
          <th>Days Active</th>
          <th>Races / Day</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows are injected by JavaScript -->
      </tbody>
    </table>
  </section>


  <!-- ===================================================
       JavaScript
       - Fetch sample_data.json automatically
       - Tab switching logic
       - Render Leaderboard
       - Render Races Per Day
       =================================================== -->
  <script>
    // Wait for DOM to be fully parsed
    document.addEventListener('DOMContentLoaded', () => {

      /*** TAB SWITCHING SETUP ***/
      const tabs      = document.querySelectorAll('.tabs .tab');
      const sections  = document.querySelectorAll('.table-container');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // deactivate all tabs & sections
          tabs.forEach(t => t.classList.remove('active'));
          sections.forEach(s => s.classList.remove('active'));
          // activate selected
          tab.classList.add('active');
          document
            .getElementById(tab.dataset.target)
            .classList.add('active');
        });
      });


      /*** DATA FETCH & RENDER ***/
      fetch('sample_data.json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status} - ${response.statusText}`);
          }
          return response.json();
        })
        .then(racers => {
          if (!Array.isArray(racers)) {
            throw new Error('sample_data.json must be an array of racer objects');
          }
          // enrich & render both tables
          renderLeaderboard(racers);
          renderRacesPerDay(racers);
        })
        .catch(err => {
          console.error('Failed to load data:', err);
          const msg = document.createElement('p');
          msg.textContent = 'Error loading sample_data.json â€“ check console.';
          msg.style.color = '#ff5252';
          msg.style.textAlign = 'center';
          document.body.appendChild(msg);
        });


      /**
       * Renders the main leaderboard table.
       * Sorts by total races descending.
       */
      function renderLeaderboard(data) {
        // sort descending by racesPlayed
        data.sort((a, b) => b.racesPlayed - a.racesPlayed);

        const tbody = document
          .querySelector('#leaderboardTable tbody');
        tbody.innerHTML = ''; // clear

        const fragment = document.createDocumentFragment();

        data.forEach((r, idx) => {
          // build a table row for each racer
          const tr = document.createElement('tr');

          // use data-label for responsive
          tr.innerHTML = `
            <td data-label="Rank">${idx + 1}</td>
            <td data-label="Username">${r.username}</td>
            <td data-label="Team Tag">${r.tag}</td>
            <td data-label="Title">${r.title}</td>
            <td data-label="Total Races">${r.racesPlayed}</td>
            <td data-label="Avg WPM">${r.avgSpeed}</td>
            <td data-label="Top WPM">${r.highestSpeed}</td>
            <td data-label="Profile Views">${r.profileViews}</td>
            <td data-label="Member Since">${r.joinDate}</td>
            <td data-label="Garage Cars">${r.garageCars}</td>
            <td data-label="Profile URL">
              <a class="profile-link" href="${r.profileURL}" target="_blank">
                View Profile
              </a>
            </td>
            <td data-label="Membership">${r.membership}</td>
            <td data-label="Nitros Used">${r.nitrosUsed}</td>
            <td data-label="Longest Session">${r.longestSession}</td>
            <td data-label="League Tier">${r.leagueTier}</td>
          `.trim();

          fragment.appendChild(tr);
        });

        tbody.appendChild(fragment);
      }


      /**
       * Renders the Races Per Day table.
       * Calculates daysActive & races per day.
       */
      function renderRacesPerDay(data) {
        // map to new array with per-day metric
        const list = data.map(r => {
          // parse joinDate (YYYY-MM-DD)
          const joinDate = new Date(r.joinDate + 'T00:00:00Z');
          const now      = new Date();
          let diffMs      = now - joinDate;
          // convert ms to days
          let daysActive  = Math.floor(diffMs / (1000 * 60 * 60 * 24));
          if (daysActive < 1) daysActive = 1; // everyone has at least 1 day
          // races per day, two-decimal
          const racesPerDay = (r.racesPlayed / daysActive).toFixed(2);
          return {
            username:     r.username,
            racesPlayed:  r.racesPlayed,
            daysActive:   daysActive,
            racesPerDay:  racesPerDay
          };
        });

        // sort descending by racesPerDay
        list.sort((a, b) => b.racesPerDay - a.racesPerDay);

        const tbody = document
          .querySelector('#racesPerDayTable tbody');
        tbody.innerHTML = ''; // clear

        const fragment = document.createDocumentFragment();

        list.forEach((r, idx) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td data-label="Rank">${idx + 1}</td>
            <td data-label="Username">${r.username}</td>
            <td data-label="Total Races">${r.racesPlayed}</td>
            <td data-label="Days Active">${r.daysActive}</td>
            <td data-label="Races / Day">${r.racesPerDay}</td>
          `.trim();
          fragment.appendChild(tr);
        });

        tbody.appendChild(fragment);
      }

    }); // end DOMContentLoaded
  </script>
</body>
</html>
